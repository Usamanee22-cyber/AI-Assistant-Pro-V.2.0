<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Lange-Model V83.9.1: Master Lab (Big QR)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500&family=Noto+Sans+Thai:wght@300;700;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Noto Sans Thai', sans-serif; box-sizing: border-box; }
        body { background: #010409; color: #e6edf3; height: 100vh; overflow: hidden; margin: 0; }
        .code-font { font-family: 'Fira Code', monospace; }
        .hidden { display: none !important; }
        
        #viewport, #userViewport { 
            flex: 1; overflow-y: auto; padding: 25px; 
            background: radial-gradient(circle at center, #0d1117 0%, #010409 100%); 
            display: flex; flex-direction: column; gap: 12px; 
        }
        .msg-line { display: flex; width: 100%; animation: fadeIn 0.2s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; } }
        .assistant { justify-content: flex-start; }
        .user { justify-content: flex-end; }
        .bubble { padding: 10px 16px; font-size: 14px; max-width: 75%; border-radius: 18px; }
        .assistant .bubble { background: #161b22; border-left: 3px solid #238636; }
        .user .bubble { background: rgba(35, 134, 54, 0.2); border: 1px solid #238636; color: #4ade80; }

        .vocab-category { margin-bottom: 20px; border-bottom: 1px solid #30363d; padding-bottom: 10px; }
        .vocab-word { display: inline-block; background: #161b22; color: #8b949e; padding: 2px 8px; border-radius: 4px; margin: 2px; font-size: 10px; }
        
        /* QR Container Styling */
        .qr-wrapper { background: white; padding: 8px; border-radius: 12px; box-shadow: 0 0 20px rgba(74, 222, 128, 0.2); }
    </style>
</head>
<body>

<div id="gatekeeper" class="h-full flex flex-col items-center justify-center bg-[#0d1117] p-6">
    <div class="text-center mb-8">
        <div class="w-16 h-16 bg-green-500 rounded-2xl mx-auto mb-4 flex items-center justify-center text-4xl font-black text-black">L</div>
        <h1 class="text-3xl font-black text-white">LANGE <span class="text-green-500">V83.9.1</span></h1>
    </div>
    <div class="w-full max-w-xs space-y-3">
        <input type="text" id="accessName" class="w-full bg-[#161b22] border border-[#30363d] p-4 rounded-2xl text-center text-white outline-none" placeholder="NAME">
        <button onclick="unlockGate()" class="w-full bg-white text-black p-4 rounded-2xl font-black">INITIALIZE</button>
    </div>
</div>

<div id="scannerUI" class="hidden h-full flex flex-col items-center justify-center bg-black p-6">
    <h2 class="text-green-500 font-black text-xl mb-6 tracking-widest uppercase">Scanning...</h2>
    <div id="reader" style="width: 350px; border-radius: 20px; overflow: hidden; border: 2px solid #238636;"></div>
</div>

<div id="devUI" class="hidden h-full flex flex-col">
    <header class="p-4 border-b border-[#30363d] flex justify-between items-center bg-[#010409]">
        <div class="flex flex-col">
            <span class="text-[10px] text-green-500 font-black uppercase tracking-widest">Master Lab Engine</span>
            <span class="text-[9px] text-slate-500">Status: Neural Link Ready</span>
        </div>
        <div class="qr-wrapper">
            <div id="qrcode"></div>
        </div>
    </header>
    <div class="flex flex-1 overflow-hidden">
        <aside class="w-80 bg-black border-r border-[#30363d] p-4 overflow-y-auto code-font">
            <h3 class="text-white text-[12px] font-bold mb-4 border-l-4 border-green-500 pl-2">MEMORY MONOLITH</h3>
            <div id="vocabStats"></div>
        </aside>
        <main class="flex-1 flex flex-col">
            <div id="viewport"></div>
            <form id="devForm" class="p-4 border-t border-[#30363d] flex gap-2">
                <input type="text" id="devInput" class="flex-1 bg-[#161b22] p-4 rounded-xl text-white outline-none focus:border-green-500" placeholder="หมวด-คำศัพท์...">
                <button class="bg-green-600 px-6 rounded-xl font-black text-white">EXEC</button>
            </form>
        </main>
    </div>
</div>

<div id="monitorUI" class="hidden h-full bg-black p-8 flex flex-col">
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-white font-black text-2xl uppercase">Neural Stream</h2>
        <div class="flex gap-4">
            <div class="bg-[#161b22] p-3 rounded-lg"><h3 id="accVal" class="text-blue-400 text-xl font-black code-font">0%</h3></div>
            <div class="bg-[#161b22] p-3 rounded-lg"><h3 id="lossVal" class="text-red-400 text-xl font-black code-font">0%</h3></div>
        </div>
    </div>
    <div class="flex-1 bg-[#0d1117] rounded-[30px] border border-[#30363d] p-4">
        <svg width="100%" height="100%" viewBox="0 0 1000 400" preserveAspectRatio="none">
            <path id="pathAcc" d="M 0 400" stroke="#388bfd" stroke-width="3" fill="none"></path>
            <path id="pathLoss" d="M 0 400" stroke="#f85149" stroke-width="3" fill="none"></path>
        </svg>
    </div>
</div>

<div id="userUI" class="hidden h-full flex flex-col">
    <div id="userViewport"></div>
    <form id="userForm" class="p-6 flex gap-2">
        <input type="text" id="userInput" class="flex-1 bg-[#0d1117] border border-[#30363d] p-4 rounded-2xl text-white outline-none" placeholder="Talk...">
        <button class="bg-green-600 px-8 rounded-2xl font-bold">SEND</button>
    </form>
</div>

<script>
// (ใช้ DATABASE เดิมที่คุณโตนัสชอบ)
const MEGA_DB = {
    "ทักทาย": ["สวัสดี","ฮัลโหล","หวัดดี","ดีจ้า","โย่ว","ไฮ","กราบ","อรุณสวัสดิ์","ราตรีสวัสดิ์","สบายดีไหม","เป็นไงบ้าง","ทักทาย","ยินดีที่รู้จัก","ไฮฮาย","โหลๆ","ว่าไง","สวัสสดี","ดีครับ","ดีค่ะ","หวัดดีครับ","หวัดดีค่ะ","ยินดี","เซย์ไฮ","ดีจ่ะ","สบายดีนะ","หวังว่าดี","ดีๆ","ทัก","ไฮเพื่อน","สวัสดีเพื่อน","ดีจ้าเพื่อน"],
    "ธุรกิจ": ["ทุน","กำไร","ขาดทุน","งบประมาณ","หุ้น","ลงทุน","ตลาด","เศรษฐกิจ","เงินเฟ้อ","ภาษี","ธนาคาร","ดอกเบี้ย","รายรับ","รายจ่าย","บัญชี","สต็อก","โกดัง","ขนส่ง","ส่งออก","นำเข้า","สัญญา","หุ้นส่วน","ธุรกิจ","ผลิต","บริการ","ลูกค้า","พนักงาน","เงินเดือน","โบนัส","ยอดขาย","การตลาด","โฆษณา","แบรนด์","คู่แข่ง","เป้าหมาย","กลยุทธ์","ความเสี่ยง","จัดการ","ทรัพยากร","นวัตกรรม","เติบโต","ประมูล","ราคา","ส่วนลด","โปรโมชั่น","ยอดจอง","หนี้สิน","เครดิต","เช็ค","เงินสด","โอนเงิน","บิล","ใบเสร็จ","ส่งของ","กู้ยืม","ประกัน","สินทรัพย์","ที่ดิน","โรงงาน","เครื่องจักร","ประเมิน","วิเคราะห์","รายงาน","มติ","กฎหมาย","นโยบาย","วางแผน","การเงิน"],
    "สัตว์": ["หมา","แมว","เสือ","สิงโต","ช้าง","ม้า","วัว","ควาย","ลิง","นก","ปลา","กุ้ง","หอย","ปู","เป็ด","ไก่","หมี","กระต่าย","หนู","งู","กบ","เต่า","จระเข้","แมลง","ผึ้ง","มด","แมงมุม","ยุง","ผีเสื้อ","กวาง","เก้ง","หมู","แพะ","แกะ","อูฐ","ยีราฟ","ม้าลาย","แรด","ฮิปโป","จิงโจ้","เพนกวิน","นกยูง","นกฮูก","ห่าน","ปลาทอง","ปลาวาฬ","โลมา","แมวน้ำ","ปลาหมึก","ม้าน้ำ","หอยทาก","ตะขาบ","แมงป่อง","กิ้งกือ","จิ้งจก","ตุ๊กแก","กิ้งก่า","คางคก","พะยูน","ตุ่น","ตะกวด","กระทิง","นกเขา","นกพิราบ","อินทรี","นางนวล","กระจอกเทศ","กระเรียน","กระยาง","ฉลาม","ค้างคาว","แมลงวัน","หมัด","เห็บ","ชะนี","คัมภีร์","ยมทูต","ปลาคาร์พ","ปูดำ","ปูม้า"],
    "คุยเล่น": ["เหงา","ตลก","ขำ","สนุก","เบื่อ","เซ็ง","ไปไหนดี","กินไรดี","ทำไรอยู่","จริงหรอ","สุดยอด","เทพ","เก่ง","น่ารัก","ชอบ","รัก","ดีใจ","เสียใจ","โกรธ","หิว","ง่วง","นอน","ตื่น","อาบน้ำ","ไปเที่ยว","ดูหนัง","ฟังเพลง","เล่นเกม","คุยกัน","คิดถึง","ฝัน","สวย","หล่อ","เท่","แนว","วัยรุ่น","ดารา","ความรู้สึก","เพื่อน","แฟน","โสด","ยิ้ม","หัวเราะ","ฮ่าๆ","อิอิ","อุ๊ย","ว้าว","โอ้โห","พระเจ้า","แปลก","มหัศจรรย์","ลึกลับ","ปริศนา","คำถาม","คำตอบ","ฉลาด","บ้า","ไร้สาระ","สาระ","ความรู้","เคล็ดลับ","ลองดู","สู้ๆ","พยายาม","อดทน","ความหวัง","โชคดี","โชคร้าย","เพ้อ","รำคาญ","งอน","หึง","หวง","ห่วง","ใจเย็น","ใจร้อน","ขยัน","ขี้เกียจ"],
    "คณิต": ["บวก","ลบ","คูณ","หาร","เท่ากับ","สมการ","โจทย์","ตัวเลข","เลข","เปอร์เซ็นต์","ร้อยละ","สแควรูท","ยกกำลัง","เศษส่วน","ทศนิยม","วงเล็บ","ค่าคงที่","ตัวแปร","พีชคณิต","ตรีโกณ","แคลคูลัส","สถิติ","ความน่าจะเป็น","กราฟ","พิกัด","มุม","องศา","เรเดียน","วงกลม","สามเหลี่ยม","สี่เหลี่ยม","พื้นที่","ปริมาตร","รัศมี","เส้นผ่านศูนย์กลาง","ด้าน","ฐาน","สูง","ยาว","กว้าง","ลึก","น้ำหนัก","ระยะทาง","เวลา","ความเร็ว","ความเร่ง","แรง","พลังงาน","อุณหภูมิ","กระแส","แรงดัน","ความต้านทาน","ฐานสอง","ฐานสิบ","ตรรกศาสตร์","เซต","ฟังก์ชัน","ลิมิต","อนุพันธ์","อินทิเกรต","เมทริกซ์","เวกเตอร์","ระนาบ","มิติ","หนึ่ง","สอง","สาม","สี่","ห้า","หก","เจ็ด","แปด","เก้า","สิบ","ร้อย","พัน","หมื่น","แสน","ล้าน"],
    "ปรึกษา": ["แนะนำ","ปรึกษา","ช่วยเหลือ","ทางออก","วิธี","ขั้นตอน","อยากรู้","ช่วยบอก","ช่วยสอน","เรียน","ศึกษา","พัฒนา","แก้ไข","ปรับปรุง","สร้าง","ทำ","ออกแบบ","เป้าหมาย","ความสำเร็จ","ปัญา","อุปสรรค","ชีวิต","อนาคต","สุขภาพ","จิตใจ","ความเครียด","กกังวล","โรค","ยา","รักษา","หมอ","พยาบาล","ความรัก","ความสัมพันธ์","แต่งงาน","ครอบครัว","สิทธิ","หน้าที่","ศีลธรรม","ศาสนา","ความเชื่อ","สมาธิ","สติ","ปัญญา","ความสุข","สงบ","แรงบันาลใจ","กำลังใจ","ตัดสินใจ","ระวัง","ป้องกัน","เตรียมตัว","พร้อม","โอกาส","ประสบการณ์","บทเรียน","ขอโทษ","ขอบคุณ","แบ่งปัน","จิตอาสา","สังคม","สิ่งแวดล้อม","ประหยัด","ยั่งยืน","พอเพียง","คำแนะนำ","ช่วยหน่อย","ทำไงดี"],
    "อิสระ": ["อวกาศ","ท้องฟ้า","ดวงดาว","จักรวาล","โลก","ดวงจันทร์","ดวงอาทิตย์","กาแล็กซี","มนุษย์ต่างดาว","ยูเอฟโอ","หุ่นยนต์","เอไอ","จินตนาการ","สีสัน","ดนตรี","ศิลปะ","ภาพวาด","นิยาย","การ์ตูน","กีฬา","ฟุตบอล","ว่ายน้ำ","วิ่ง","ทะเล","น้ำตก","ป่าไม้","ภูเขา","ทุ่งหญ้า","ดอกไม้","ต้นไม้","ก้อนเมฆ","สายฝน","พายุ","หิมะ","หนาว","ร้อน","อบอุ่น","ลม","แสงแดด","รุ้ง","เสรีภาพ","อิสรภาพ","สันติภาพ","เท่าเทียม","ยุติธรรม","ประวัติศาสตร์","วัฒนธรรม","ประเพณี","โบราณ","ทันสมัย","ล้ำยุค","เวทมนตร์","ปาฏิหาริย์","วิญญาณ","ผี","นรก","สวรรค์","โชคชะตา","พรหมลิขิต","กาลเวลา","มิติ","ความว่างเปล่า","จุดเริ่มต้น","จุดจบ","นิรันดร์","ผจญภัย","แผนที่","เข็มทิศ","เรือ","เครื่องบิน","รถยนต์","เทคโนโลยี","ความล้ำ","สิ่งประดิษฐ์","ความจริง","แสง","เสียง","สัมผัส","รสชาติ","กลิ่น","ชีวิต","มนุษย์"]
};

const CHAT_STYLE = {
    "ทักทาย": ["สวัสดีครับคุณโตนัส! ยินดีที่ได้พบกันนะ", "หวัดดีครับ! วันนี้ Lange พร้อมรับคำสั่งแล้ว"],
    "ธุรกิจ": ["วิเคราะห์ข้อมูลธุรกิจอยู่... พร้อมคุยครับ", "การเติบโตของทุนเป็นหัวใจหลักเลยนะ"],
    "สัตว์": ["สัตว์โลกน่าทึ่งเสมอเลยนะครับ", "ธรรมชาติช่างสร้างสรรค์สิ่งสวยงามจริงๆ"],
    "คุยเล่น": ["ฮ่าๆ คุยกับคุณแล้วสนุกดีนะ", "Lange ชอบฟังเรื่องที่คุณแชร์จัง"],
    "คณิต": ["คำนวณเสร็จเรียบร้อย! ข้อมูลแม่นยำครับ", "ตรรกะคณิตศาสตร์สวยงามจริงๆ"],
    "ปรึกษา": ["Lange จะช่วยหาทางออกให้ดีที่สุดครับ", "ไม่ต้องกังวลนะ เรามาช่วยกันคิดทีละสเต็ป"],
    "อิสระ": ["ล้ำลึกมากครับ... หัวข้อนี้ทำให้เราเห็นโลกกว้างขึ้น", "จักรวาลนี้ยังมีเรื่องให้ค้นพบอีกเยอะเลย"]
};

class LangeCoreEngine {
    constructor() {
        const saved = localStorage.getItem('LANGE_V83_91');
        this.vocab = saved ? JSON.parse(saved) : MEGA_DB;
        this.acc = Array(50).fill(380); this.loss = Array(50).fill(50);
    }
    save() { localStorage.setItem('LANGE_V83_91', JSON.stringify(this.vocab)); }
    process(text, isDev) {
        if(isDev && text.includes('-')) {
            const [cat, word] = text.split('-').map(s => s.trim());
            if(this.vocab[cat]) { this.vocab[cat].push(word); this.save(); this.updateGraph(true); return { reply: `บันทึก "${word}" แล้ว` }; }
        }
        let found = Object.keys(this.vocab).find(c => this.vocab[c].some(w => text.includes(w)));
        this.updateGraph(!!found);
        if(found) return { reply: CHAT_STYLE[found][Math.floor(Math.random() * CHAT_STYLE[found].length)] };
        return { reply: "Lange กำลังคิด... ขอข้อมูลเพิ่มหน่อยครับ" };
    }
    updateGraph(s) {
        let la = this.acc[this.acc.length-1], ll = this.loss[this.loss.length-1];
        this.acc.push(Math.min(500, Math.max(0, la + (s ? 25 : -35) + (Math.random()*20-10))));
        this.loss.push(Math.min(500, Math.max(0, ll + (s ? -20 : 30) + (Math.random()*20-10))));
        if(this.acc.length > 50) { this.acc.shift(); this.loss.shift(); }
    }
}

const engine = new LangeCoreEngine();
const SYNC_KEY = "LANGE_BIG_QR_91";
let peer, conn;

function unlockGate() {
    const name = document.getElementById('accessName').value.trim();
    if(name === "โตนัส") {
        const choice = prompt("สวัสดีคุณโตนัส:\n1 - Master Lab\n2 - Monitor");
        document.getElementById('gatekeeper').classList.add('hidden');
        if(choice === "1") initRole('DEV');
        else if(choice === "2") startScanner();
    } else {
        document.getElementById('gatekeeper').classList.add('hidden');
        initRole('USER');
    }
}

function startScanner() {
    document.getElementById('scannerUI').classList.remove('hidden');
    const sc = new Html5Qrcode("reader");
    sc.start({ facingMode: "environment" }, { fps: 15, qrbox: 250 }, (id) => {
        if(id === SYNC_KEY) { sc.stop(); document.getElementById('scannerUI').classList.add('hidden'); initRole('MONITOR'); }
    });
}

function initRole(role) {
    if(role === 'DEV') {
        document.getElementById('devUI').classList.remove('hidden');
        peer = new Peer(SYNC_KEY);
        // QR Code ขนาดใหญ่ขึ้น (120px) สแกนง่าย
        peer.on('open', id => new QRCode(document.getElementById("qrcode"), {text:id, width:120, height:120}));
        peer.on('connection', c => { conn = c; });
        renderDeepVocab();
    } else if(role === 'MONITOR') {
        document.getElementById('monitorUI').classList.remove('hidden');
        peer = new Peer();
        peer.on('open', () => {
            const c = peer.connect(SYNC_KEY);
            c.on('data', data => { engine.acc = data.acc; engine.loss = data.loss; drawGraph(); });
        });
    } else {
        document.getElementById('userUI').classList.remove('hidden');
    }
}

function renderDeepVocab() {
    document.getElementById('vocabStats').innerHTML = Object.entries(engine.vocab).map(([cat, words]) => `
        <div class="vocab-category">
            <div class="flex justify-between text-[11px] font-black text-green-500 mb-1">
                <span>[${cat}]</span><span>${words.length}</span>
            </div>
            <div class="flex flex-wrap">${words.map(w => `<span class="vocab-word">${w}</span>`).join('')}</div>
        </div>
    `).join('');
}

function drawGraph() {
    const path = (id, pts) => {
        let d = `M 0 ${400 - (pts[0]/500)*400}`;
        pts.forEach((v, i) => d += ` L ${i * 20} ${400 - (v/500)*400}`);
        document.getElementById(id).setAttribute('d', d);
    };
    path('pathAcc', engine.acc); path('pathLoss', engine.loss);
    document.getElementById('accVal').innerText = (engine.acc[engine.acc.length-1]/5).toFixed(1) + "%";
    document.getElementById('lossVal').innerText = (engine.loss[engine.loss.length-1]/5).toFixed(1) + "%";
}

const handleChat = (f, i, v, isDev) => {
    document.getElementById(f).onsubmit = (e) => {
        e.preventDefault();
        const inp = document.getElementById(i);
        const res = engine.process(inp.value, isDev);
        const view = document.getElementById(v);
        view.innerHTML += `<div class="msg-line user"><div class="bubble">${inp.value}</div></div>
                           <div class="msg-line assistant"><div class="bubble">${res.reply}</div></div>`;
        if(isDev && conn) conn.send({ acc: engine.acc, loss: engine.loss });
        inp.value = ""; renderDeepVocab();
        view.scrollTop = view.scrollHeight;
    };
}
handleChat('devForm', 'devInput', 'viewport', true);
handleChat('userForm', 'userInput', 'userViewport', false);
</script>
</body>
</html>
