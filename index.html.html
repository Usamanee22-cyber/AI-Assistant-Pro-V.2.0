<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Lange-Model V.95.3 (900-Words Absolute)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Noto+Sans+Thai:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Noto Sans Thai', sans-serif; box-sizing: border-box; }
        body { background: #010409; color: #e6edf3; height: 100vh; overflow: hidden; margin: 0; }
        .glass { background: rgba(13, 17, 23, 0.9); backdrop-filter: blur(10px); border: 1px solid #30363d; }
        .v95-accent { color: #58a6ff; }
        #viewport { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .msg-line { display: flex; width: 100%; }
        .bubble { padding: 10px 16px; border-radius: 18px; max-width: 85%; min-width: 40px; width: auto; line-height: 1.5; font-size: 14px; word-wrap: break-word; display: inline-block; }
        .assistant .bubble { background: #161b22; border: 1px solid #30363d; border-left: 4px solid #58a6ff; }
        .user { justify-content: flex-end; }
        .user .bubble { background: #1f6feb; color: white; border-bottom-right-radius: 4px; }
        .trace-line { font-family: 'Fira Code', monospace; font-size: 10px; padding: 2px 8px; border-left: 2px solid #58a6ff; margin-bottom: 2px; color: #8b949e; }
        .hidden { display: none !important; }
        .v-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; }
        .v-item { font-size: 8px; background: #0d1117; border: 1px solid #30363d; color: #58a6ff; text-align: center; padding: 2px; border-radius: 3px; }
        .admin-btn { background: #21262d; padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: bold; border: 1px solid #30363d; cursor: pointer; }
        .admin-btn.active { background: #1f6feb; border-color: #58a6ff; color: white; }
        .training-status { font-size: 10px; color: #00ff88; font-family: 'Fira Code'; }
    </style>
</head>
<body>

<div id="gatekeeper" class="h-full flex flex-col items-center justify-center">
    <div class="text-center mb-8">
        <div class="w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-3xl mx-auto mb-4 flex items-center justify-center text-4xl font-black text-white shadow-xl">L</div>
        <h1 class="text-3xl font-black italic">LANGE <span class="v95-accent">V95.3</span></h1>
    </div>
    <div class="w-72 space-y-4">
        <input type="text" id="accessName" class="w-full bg-[#0d1117] border border-[#30363d] p-4 rounded-xl text-center text-white outline-none focus:border-blue-500 font-bold" placeholder="NAME">
        <button onclick="checkAccess()" class="w-full bg-blue-600 text-white p-4 rounded-xl font-black shadow-lg">INITIALIZE SYSTEM</button>
    </div>
</div>

<div id="mainSystem" class="hidden h-full flex flex-col">
    <header id="adminBar" class="p-3 bg-black border-b border-[#30363d] flex justify-between items-center">
        <div class="flex gap-2">
            <button id="btnChat" onclick="switchMode('chat')" class="admin-btn active">AI CHAT</button>
            <button id="btnLearning" onclick="switchMode('learning')" class="admin-btn">MONOLITH</button>
            <button id="btnGraph" onclick="switchMode('graph')" class="admin-btn">NEURAL FLOW</button>
        </div>
        <div id="trainCounter" class="training-status">STANDBY</div>
    </header>

    <div class="flex-1 overflow-hidden flex">
        <div id="chatView" class="flex-1 flex flex-col overflow-hidden">
            <div id="viewport"></div>
            <div id="processTrace" class="h-40 glass border-t border-[#30363d] p-4 overflow-y-auto">
                <div id="traceLog"></div>
            </div>
            <form id="chatForm" class="p-4 bg-black border-t border-[#30363d] flex gap-3">
                <input type="text" id="userInput" class="flex-1 bg-[#0d1117] p-4 rounded-xl text-white outline-none border border-transparent focus:border-blue-500 text-sm" placeholder="Ask Lange-Model...">
                <button type="submit" class="bg-blue-600 px-8 rounded-xl font-black text-white text-sm">SYNTHESIZE</button>
            </form>
        </div>

        <div id="learningView" class="hidden flex-1 p-8 bg-[#010409] overflow-y-auto">
            <h2 class="text-xl font-black mb-4 v95-accent italic">9-CORE MONOLITH (900 WORDS)</h2>
            <div class="mb-6 p-4 border border-[#30363d] rounded-xl bg-black">
                <p class="text-[11px] text-gray-400 mb-3 uppercase font-black">Memory Injection: หมวด-คำใหม่</p>
                <div class="flex gap-2">
                    <input type="text" id="learnInput" class="flex-1 bg-[#0d1117] border border-[#30363d] p-3 rounded-lg text-sm text-white" placeholder="เช่น: ทักทาย-สวัสดีชาวโลก">
                    <button onclick="trainToken()" class="bg-blue-600 px-6 rounded-lg font-bold text-sm text-white">TRAIN</button>
                </div>
            </div>
            <div id="vocabList" class="space-y-4"></div>
        </div>

        <div id="graphView" class="hidden flex-1 p-8 bg-[#010409] overflow-y-auto">
            <h2 class="text-xl font-black mb-4 v95-accent italic">NEURAL DENSITY PROGRESS</h2>
            <div class="glass p-6 rounded-2xl h-[450px] w-full">
                <canvas id="liveLossChart"></canvas>
            </div>
            <div id="trainProgressUI" class="mt-4 text-[10px] text-gray-500 font-mono"></div>
        </div>
    </div>
</div>

<script>
// --- [MONOLITH: 900 คำจริง 9 หมวด] ---
const RAW_MONOLITH = {
    "ทักทาย": ["สวัสดี","หวัดดี","ไฮ","ฮัลโหล","อรุณสวัสดิ์","สายัณห์สวัสดิ์","ราตรีสวัสดิ์","สบายดีไหม","ยินดีที่พบ","กราบ","ทักทาย","โย่ว","ดีจ้า","สำบายดี","สบายดีบ่","ว่าไง","สิเน่หา","คารวะ","ประณต","ไหว้","ต้อนรับ","เชิญ","มาแล้ว","ถึงแล้ว","เริ่มกันเลย","หวัดดีครับ","หวัดดีค่ะ","สวัสดีจ้ะ","มอร์นิ่ง","ดีครับ","ดีค่ะ","ฮัลโหลล","ว่าไงเพื่อน","สวัสดียามเช้า","สวัสดียามเย็น","สบายดีนะ","ยินดีต้อนรับ","ไฮเทค","ทักทายกัน","เริ่มต้นใหม่","กราบสวัสดีครับ","กราบสวัสดีค่ะ","ดีเนาะ","สบายดีแหละ","โอเคไหม","ทักนะ","ฮัลเหล","สวัสดีนะ","ดีดีดี","ตื่นยัง","กินข้าวยัง","ทำไรอยู่","คิดถึงนะ","ทักทายยามบ่าย","ทักทายยามค่ำ","มอร์นิ่งจ้า","ดีจ้าทุกคน","มาพบกัน","เจอกันอีกแล้ว","สวัสดีท่าน","เคารพครับ","เคารพค่ะ","หวัดดีจ้าาา","ดีคร้าบ","สวัสดียามดึก","สบายดีไหมครับ","สบายดีไหมค่ะ","ยินดีที่ได้รู้จัก","พบหน้า","สบตา","ทักเฉยๆ","ทักทายรอบวง","ดีเลิศ","ประเสริฐ","ทักจ้า","ทักครับ","ทักค่ะ","ฮายยย","เอ้าหวัดดี","สวัสดีชาวโลก","สวัสดีพี่น้อง","ดีแฮะ","หวัดดีจ่ะ","สวัสดิ์","สวัสดิภาพ","ทักทายทั่วไป","ยินดีจริงๆ","ทักใหม่","สวัสดีรอบที่ล้าน","มาแล้วนะ","ดีดี","สบายดีมาก","พร้อมยัง","ทักทายกันหน่อย","เริ่มสนทนา","โอ้สวัสดี","สวัสดิ์ดี","ทักทายท่าน","เชิญครับ","เชิญค่ะ","ยินดีที่ได้พบกัน","สวัสดิการ"],
    "ลาจาก": ["ลาก่อน","ไปแล้วนะ","บ๊ายบาย","โชคดี","ลาแล้ว","ขอตัว","ไปล่ะ","พบกันใหม่","ไว้เจอกัน","เจอกัน","เลิกกัน","จบกัน","แยกย้าย","ลาที","ไปก่อนนะ","บ๊าย","บาย","ไปและ","ไปแล้ว","ขอลา","นัดหน้า","ลาลับ","อำลา","อาลัย","จดจำ","ทางใครทางมัน","กลับบ้าน","พักผ่อน","นอนล่ะ","ฝันดี","ราตรีสวัสดิ์นะ","ลาก่อนเพื่อน","ลาแล้วจ้า","ลาก่อนครับ","ลาก่อนค่ะ","ไปเรียนก่อน","ไปทำงานก่อน","ค่อยคุยกัน","หมดเวลา","หยุดแค่นี้","ขออนุญาต","ไปละนะ","บายๆ","บ๊ายบายจ้า","ลาก่อนนะ","พบกันพรุ่งนี้","ไว้คุยกันใหม่","เจอกันนะ","ไปล่ะจ้า","ลาก่อนคนดี","อำลาท่าน","ปิดระบบ","พักเครื่อง","หยุดทำงาน","จบการสนทนา","ไปกินข้าว","ไปอาบน้ำ","ไปนอน","จะไปแล้ว","ลาขาด","ลาก่อนชั่วคราว","ลาพักร้อน","ลาป่วย","ลากิจ","ลาออก","ไปเถอะ","เดินต่อไป","ขอลาพ่ะย่ะค่ะ","ขอบคุณและลาก่อน","ลาเด้อ","ไปแล้วเด้อ","ลาก่อนพี่น้อง","ลาก่อนทุกคน","พบกันชาติหน้า","ลาโลก","ลาก่อนปัจจุบัน","ไว้เจอกันจ้า","ไปล่ะนะจ๊ะ","ลาก่อนจริงๆ","ลาก่อนนะเพื่อนรัก","จบภารกิจ","ปิดหน้าต่าง","กลับก่อน","ขอตัวก่อน","ลานะครับ","ลานะค่ะ","ไปแล้วครับ","ไปแล้วค่ะ","ขอลาก่อน","ขอไปก่อน","เจอกันคราวหน้า","เลิกรา","จบลง","ลาจากกัน","สิ้นสุด","เลิกลา","ไปก่อนเด้อ","บายจ้า","บ๊ายจ้า"],
    "อุทาน": ["โอ้โห","ว้าว","อัยย่ะ","แม่เจ้า","พระเจ้า","เหลือเชื่อ","ทึ่ง","ประหลาดใจ","โอเค","ตกลง","รับทราบ","ชัวร์","แน่นอน","ชัดเจน","เยี่ยม","ยอดเยี่ยม","สุดยอด","เจ๋ง","ปังมาก","เช็คเมท","ยอมรับ","ทึ่งเลย","แปลก","มหัศจรรย์","เลิศ","หรู","แพง","ดูดี","เก๋","เท่","เฉียบ","คม","จริง","ใช่เลย","ถูกต้อง","ถูกต้องที่สุด","แม่นยำ","เป๊ะ","ตรงเป้า","ยอดไปเลย","แจ๋ว","สะเด็ด","เด็ดขาด","เด็ดมาก","โดนใจ","ถูกใจ","ชอบ","รักเลย","หลงเลย","ปลื้ม","ปลาบปลื้ม","ดีใจ","ยินดี","ไชโย","สำเร็จ","เย้","วู้ว","ว้าวๆ","โอ้ว","โห้","อื้อหือ","อู้หู","โอ้มายก๊อด","สุดจัด","ปลัดบอก","จัดว่าเด็ด","เด็ดดวง","เหนือชั้น","ขั้นเทพ","สุดติ่ง","กระดิ่งแมว","แรงมาก","แรงเว่อร์","ที่สุด","อย่างแรง","อย่างเด็ด","เท่ระเบิด","ระเบิด","อลังการ","งานสร้าง","เลอค่า","สมบูรณ์","เพอร์เฟกต์","เยี่ยมยอด","โดดเด่น","ไม่ธรรมดา","พิเศษ","วิเศษ","เลิศเลอ","เลอโฉม","น่านับถือ","น่าพอใจ","พอใจมาก","พึงพอใจ","ดีงาม","พระรามแปด","งามไส้","งามงด","สวยงาม","ยอดเยี่ยมกระเทียมดอง","ของแท้","ตัวจริง","ชัดแจ๋ว","แม่นเป๊ะ"],
    "คณิตศาสตร์": ["บวก","ลบ","คูณ","หาร","เท่ากับ","สมการ","โจทย์","ตัวเลข","ร้อยละ","เศษส่วน","ทศนิยม","ยกกำลัง","รูท","พีชคณิต","แคลคูลัส","สถิติ","พิกัด","เรขาคณิต","ตรีโกณ","อนุพันธ์","อินทิกรัล","เมทริกซ์","เวกเตอร์","ความสัมพันธ์","ฟังก์ชัน","ลิมิต","พื้นที่","ปริมาตร","วงกลม","สี่เหลี่ยม","สามเหลี่ยม","มุม","องศา","รัศมี","เส้นรอบวง","ตัวแปร","ค่าคงที่","ฐานสอง","ฐานสิบ","ตรรกศาสตร์","เซต","ความน่าจะเป็น","สูตร","นิยาม","ทฤษฎี","บทพิสูจน์","พีระมิด","ทรงกลม","ทรงกระบอก","ขนาน","ตั้งฉาก","ความชัน","จุดตัด","อนุกรม","ลำดับ","พหุนาม","สัมประสิทธิ์","นิพจน์","ตัวหารร่วม","ตัวคูณร่วม","ตาราง","ค่าเฉลี่ย","มัธยฐาน","ฐานนิยม","ส่วนเบี่ยงเบน","ความแปรปรวน","ความถี่","ตัวประกอบ","จำนวนเต็ม","จำนวนจริง","จำนวนเชิงซ้อน","ตรรกยะ","อตรรกยะ","องศาเซลเซียส","เปอร์เซ็นต์","อัตราส่วน","มาตราส่วน","แผนภูมิ","กราฟ","แกน","พิกัดฉาก","เวกเตอร์ลัพธ์","แรง","มวล","พลังงาน","น้ำหนัก","ระยะทาง","เวลา","ความเร็ว","ความเร่ง","แรงโน้มถ่วง","งาน","กำลัง","แรงบิด","แรงเสียดทาน","การกระจัด","ความหนาแน่น","ความดัน","อุณหภูมิ","ความร้อน"],
    "ธรรมชาติ": ["ป่า","เขา","ดิน","หิน","ทราย","น้ำ","ลม","ไฟ","เมฆ","หมอก","แดด","ฝน","พายุ","รุ้ง","ทะเล","คลื่น","หาด","เกาะ","ถ้ำ","แม่น้ำ","ลำธาร","น้ำตก","หุบเขา","ต้นไม้","หญ้า","ดอกไม้","ใบไม้","กิ่งไม้","ราก","เมล็ด","ผลไม้","แร่ธาตุ","ทองคำ","เงิน","เหล็ก","ทองแดง","ก๊าซ","อากาศ","ออกซิเจน","โอโซน","พายุไต้ฝุ่น","แผ่นดินไหว","ภูเขาไฟ","ลาวา","ธารน้ำแข็ง","ขั้วโลก","เส้นศูนย์สูตร","ฤดูร้อน","ฤดูหนาว","ฤดูฝน","ระบบนิเวศ","โซ่อาหาร","พืช","สัตว์","แมลง","แบคทีเรีย","รา","ไวรัส","วิวัฒนาการ","แสงสว่าง","ความมืด","กลางวัน","กลางคืน","จันทรุปราคา","ดาวเคราะห์","ดวงดาว","จักรวาล","ทางช้างเผือก","อวกาศ","สุริยะ","อุตกาบาต","เนบิวลา","หลุมดำ","แสงเหนือ","รังสียูวี","กระแสน้ำ","น้ำขึ้นน้ำลง","ปะการัง","สัตว์ป่า","สัตว์เลื้อยคลาน","สัตว์ปีก","สัตว์น้ำ","สัตว์เลี้ยงลูกด้วยนม","พฤกษา","พรรณไม้","ป่าชายเลน","ทรัพยากร","ธรรมชาติ","สิ่งแวดล้อม","มลพิษ","โลกร้อน","ภาวะเรือนกระจก","ชั้นหิน","ซากดึกดำบรรพ์","แมกมา","ถ่านหิน","น้ำมันดิบ","พลังงานแสงอาทิตย์","กังหันลม","เขื่อน"],
    "อารมณ์": ["รัก","เกลียด","โกรธ","หลง","เศร้า","ดีใจ","เสียใจ","กลัว","กล้า","สงสัย","มั่นใจ","ตื่นเต้น","เบื่อ","เหงา","ท้อ","หิว","อิ่ม","ง่วง","เหนื่อย","สดชื่น","เครียด","กกังวล","ภูมิใจ","ละอาย","สำนึก","ขอบคุณ","ขอโทษ","เมตตา","กรุณา","มุทิตา","อุเบกขา","สงบ","ฟุ้งซ่าน","ห่วง","ใย","คิดถึง","โหยหา","เจ็บ","ปวด","ร้าว","ทรมาน","สุข","สำราญ","รื่นรมย์","หงุดหงิด","รำคาญ","อาฆาต","แค้น","อภัย","ชื่นชม","ศรัทธา","หวัง","สิ้นหวัง","อนาถ","เวทนา","เอ็นดู","รังเกียจ","ดูถูก","เหยียด","ยอมรับ","ปฏิเสธ","จริงใจ","หลอกลวง","ซื่อสัตย์","ทรยศ","ซาบซึ้ง","ประทับใจ","เขิน","อาย","ประหม่า","โล่งใจ","ตกใจ","สับสน","ลังเล","แน่วแน่","ใจดี","ใจดำ","ใจร้าย","ใจเย็น","ใจร้อน","เกรงใจ","ถ่อมตัว","จองหอง","อวดดี","ดื้อ","ยอม","หมั่นไส้","หวงแหน","ห่วงใย","อาลัยอาวรณ์","คะนึง","รำพึง","สะเทือนใจ","สะใจ","สะพรึง","ผว","หวั่นไหว","หวั่นกลัว","สยอง","ขนพอง","สยองขวัญ"],
    "เทคโนโลยี": ["คอมพิวเตอร์","ปัญญาประดิษฐ์","หุ่นยนต์","อินเทอร์เน็ต","ซอฟต์แวร์","ฮาร์ดแวร์","รหัส","โปรแกรม","ข้อมูล","ฐานข้อมูล","เครือข่าย","เซิร์ฟเวอร์","คลาวด์","สมาร์ทโฟน","แอปพลิเคชัน","นวัตกรรม","ดิจิทัล","อัลกอริทึม","ควอนตัม","บล็อกเชน","ไซเบอร์","ความปลอดภัย","แฮกเกอร์","ไวรัสคอมพิวเตอร์","ไฟร์วอลล์","วงจร","เซ็นเซอร์","แบตเตอรี่","หน้าจอ","คีย์บอร์ด","เมาส์","หน่วยประมวลผล","หน่วยความจำ","ความจุ","ความเร็ว","สัญญาณ","ไร้สาย","บลูทูธ","ไวไฟ","สื่อสาร","โทรคมนาคม","ดาวเทียม","ยานอวกาศ","อิเล็กทรอนิกส์","ไมโครชิป","นาโนเทคโนโลยี","เทคโนโลยีชีวภาพ","พลังงานสะอาด","รถยนต์ไฟฟ้า","โดรน","เสมือนจริง","ความจริงเสริม","เมตาเวิร์ส","กราฟิก","แอนิเมชัน","สตรีมมิ่ง","โซเชียลมีเดีย","แพลตฟอร์ม","ยูสเซอร์","พาสเวิร์ด","ล็อกอิน","อีเมล","เว็บไซต์","โดเมน","โฮสติ้ง","ระบบปฏิบัติการ","วินโดวส์","แมค","ลีนุกซ์","แอนดรอยด์","ไอโอเอส","แอปเปิล","กูเกิล","ไมโครซอฟท์","เฟซบุ๊ก","ติ๊กต็อก","ทวิตเตอร์","เทสลา","สเปซเอ็กซ์","สมาร์ทโฮม","อัจฉริยะ","อัตโนมัติ","การเรียนรู้ของเครื่อง","การเรียนรู้เชิงลึก","โครงข่ายประสาท","บิ๊กดาต้า","การวิเคราะห์","การคาดการณ์","การประมวลผลภาษา","การจดจำใบหน้า","การตรวจสอบอัตลักษณ์"],
    "สังคม": ["คน","มนุษย์","ครอบครัว","พ่อ","แม่","พี่","น้อง","เพื่อน","แฟน","สามี","ภรรยา","บุตร","หลาน","ญาติ","สังคม","ชุมชน","เมือง","ประเทศ","โลก","รัฐบาล","กฎหมาย","การเมือง","สิทธิ","เสรีภาพ","ความเท่าเทียม","ยุติธรรม","สันติภาพ","สงคราม","ความขัดแย้ง","ความร่วมมือ","วัฒนธรรม","ประเพณี","ศาสนา","ความเชื่อ","พิธีกรรม","การศึกษา","โรงเรียน","มหาวิทยาลัย","ความรู้","ทักษะ","อาชีพ","งาน","ธุรกิจ","เศรษฐกิจ","เงิน","ธนาคาร","การตลาด","โฆษณา","การบริโภค","สินค้า","บริการ","โรงพยาบาล","สุขภาพ","การรักษา","ยา","การท่องเที่ยว","โรงแรม","อาหาร","เครื่องดื่ม","แฟชั่น","ศิลปะ","ดนตรี","ภาพยนตร์","วรรณกรรม","กีฬา","สันทนาการ","วันหยุด","เทศกาล","การเดินทาง","ขนส่ง","สาธารณะ","ความยากจน","ความรวย","ความเหลื่อมล้ำ","อาชญากรรม","การทุจริต","สิ่งแวดล้อม","การพัฒนา","ยั่งยืน","อาสาสมัคร","การกุศล","มนุษยธรรม","ประชากร","สถิติ","แนวโน้ม","ความหลากหลาย","ชนชาติ","เผ่าพันธุ์","ภาษา","การสื่อสาร","สื่อมวลชน","ข่าว","ข้อมูลเท็จ","ความเห็น","อิทธิพล","ผู้นำ","ผู้ตาม","ความสำเร็จ","ล้มเหลว"],
    "ปรัชญา": ["ความจริง","ความหมาย","ชีวิต","ความตาย","เวลา","อดีต","ปัจจุบัน","อนาคต","ความว่างเปล่า","จิตวิญญาณ","เหตุผล","ตรรกะ","จริยธรรม","ศีลธรรม","ความดี","ความชั่ว","เสรีเจตวันง","โชคชะตา","กรรม","การเวียนว่าย","สัจธรรม","ความรู้","ความเห็น","ความเชื่อ","ศรัทธา","ปัญญา","สัมปชัญญะ","ตัวตน","อัตตา","อนัตตา","ความเป็นไปได้","สภาวะ","ประสบการณ์","การรับรู้","ความเข้าใจ","การตีความ","ความสัมพันธ์","จุดประสงค์","เป้าหมาย","อุดมคติ","ยูโทเปีย","ดิสโทเปีย","การเปลี่ยนแปลง","ความต่อเนื่อง","ความแตกต่าง","ความขัดแย้ง","ความสมดุล","ความสงบ","ความสุข","ความทุกข์","ความเพียร","ความอดทน","ความเมตตา","ความรัก","ความหวัง","ความยุติธรรม","ความกล้าหาญ","ความถ่อมตัว","ความพอเพียง","ความเป็นกลาง","ความซับซ้อน","ความเรียบง่าย","ความลึกซึ้ง","ความตื้นเขิน","ความมืด","ความสว่าง","จักรวาล","ธรรมชาติ","พระเจ้า","พลัง","พลังงาน","สติ","สมาธิ","วิปัสสนา","การตื่นรู้","การหลุดพ้น","นิพพาน","ทางสายกลาง","สติปัญญา","การไตร่ตรอง","การวิพากษ์","การเรียนรู้","การเติบโต","วิวัฒนาการ","ความก้าวหน้า","ความเสื่อม","ความคงอยู่","ความสลาย","จุดกำเนิด","จุดจบ","นิรันดร์","ชั่วคราว","สม่ำเสมอ","ไม่แน่นอน","ลึกลับ","ชัดเจน"]
};

// --- [SYSTEM LOGIC] ---
let MONOLITH = JSON.parse(localStorage.getItem('LANGE_V95_MEMORY')) || RAW_MONOLITH;
let trainingMeta = JSON.parse(localStorage.getItem('LANGE_TRAIN_META')) || { count: 0, progress: 0, lastUpdate: Date.now(), isRunning: false };

function saveMemory() {
    localStorage.setItem('LANGE_V95_MEMORY', JSON.stringify(MONOLITH));
    localStorage.setItem('LANGE_TRAIN_META', JSON.stringify(trainingMeta));
}

let currentUser = "";
let lossChart = null;
let trainData = Array.from({length: 100}, () => 0.5);
let validData = Array.from({length: 100}, () => 0.7);

function checkAccess() {
    const name = document.getElementById('accessName').value.trim();
    if (!name) return;
    currentUser = name;
    document.getElementById('gatekeeper').classList.add('hidden');
    document.getElementById('mainSystem').classList.remove('hidden');
    
    if (name !== "โตนัส") {
        document.getElementById('adminBar').classList.add('hidden');
        document.getElementById('processTrace').classList.add('hidden');
    }
    
    renderLearning();
    initLossGraph();
    startAutoTraining();
}

function switchMode(mode) {
    ['chat', 'learning', 'graph'].forEach(m => {
        document.getElementById(`btn${m.charAt(0).toUpperCase() + m.slice(1)}`).classList.toggle('active', mode === m);
        document.getElementById(`${m}View`).classList.toggle('hidden', mode !== m);
    });
}

function renderLearning() {
    document.getElementById('vocabList').innerHTML = Object.entries(MONOLITH).map(([cat, words]) => `
        <div class="p-4 bg-black border border-[#30363d] rounded-xl">
            <div class="text-xs font-black text-blue-400 mb-3 uppercase tracking-tighter">${cat} (Actual: ${words.length})</div>
            <div class="v-grid">${words.slice(0, 150).map(w => `<div class="v-item">${w}</div>`).join('')}</div>
        </div>
    `).join('');
}

function trainToken() {
    const val = document.getElementById('learnInput').value;
    if (!val.includes("-")) return;
    const [cat, word] = val.split("-").map(s => s.trim());
    if (MONOLITH[cat]) {
        MONOLITH[cat].push(word);
        saveMemory();
        renderLearning();
        document.getElementById('learnInput').value = "";
        trainingMeta.progress += 0.5;
    }
}

function startAutoTraining() {
    trainingMeta.isRunning = true;
    setInterval(() => {
        trainingMeta.progress += 0.0005; // 2 Days cycle approx
        if (trainingMeta.progress >= 100) {
            trainingMeta.count++;
            trainingMeta.progress = 0;
            addTrace("SYSTEM", `TRAINING CYCLE ${trainingMeta.count} COMPLETE.`);
        }
        document.getElementById('trainCounter').innerText = `CYCLE: ${trainingMeta.count} | ${trainingMeta.progress.toFixed(4)}%`;
        document.getElementById('trainProgressUI').innerText = `Training Status: เสร็จแล้ว ครั้งที่ ${trainingMeta.count} | Neural Weight: ${(trainingMeta.progress/100).toFixed(6)}`;
        updateNeuralGraph();
        saveMemory();
    }, 1000);
}

function initLossGraph() {
    const ctx = document.getElementById('liveLossChart').getContext('2d');
    lossChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array.from({length: 100}, (_, i) => i),
            datasets: [
                { label: 'Intelligence Curve', data: trainData, borderColor: '#58a6ff', borderWidth: 2, pointRadius: 0, tension: 0.4, fill: true, backgroundColor: 'rgba(88, 166, 255, 0.05)' },
                { label: 'Neural Stability', data: validData, borderColor: '#00ff88', borderWidth: 1, pointRadius: 0, tension: 0.4 }
            ]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            animation: { duration: 0 },
            scales: {
                y: { grid: { color: '#161b22' }, ticks: { display: false }, min: 0, max: 2 },
                x: { display: false }
            }
        }
    });
}

function updateNeuralGraph() {
    if (!lossChart) return;
    const base = trainingMeta.progress / 50; 
    trainData.shift();
    trainData.push(base + (Math.random() * 0.1));
    validData.shift();
    validData.push((base * 0.8) + (Math.random() * 0.05));
    lossChart.update();
}

async function addTrace(pillar, detail) {
    if (currentUser !== "โตนัส") return;
    const log = document.getElementById('traceLog');
    log.innerHTML += `<div class="trace-line"><strong>${pillar}:</strong> ${detail}</div>`;
    log.scrollTop = log.scrollHeight;
}

// --- [AI EVOLUTION LOGIC: TOKEN & PILLARS] ---
document.getElementById('chatForm').onsubmit = async (e) => {
    e.preventDefault();
    const input = document.getElementById('userInput');
    const text = input.value.trim();
    if (!text) return;

    document.getElementById('viewport').innerHTML += `<div class="msg-line user"><div class="bubble">${text}</div></div>`;
    
    // AI Process Tracing
    await addTrace("TOKENIZE", `Converting input into ${text.length} vectors...`);
    await addTrace("ML/DL ENGINE", "Processing through 15 Neural Pillars...");
    await addTrace("BLM PARAMS", "Accessing 900+ Parameter Monolith...");
    
    // --- [INSERTED MATH LOGIC ONLY] ---
    let mathResult = null;
    const mathRegex = /[0-9+\-*/().]{3,}/;
    if (mathRegex.test(text)) {
        try {
            // ทำการกรองเฉพาะตัวอักษรที่ใช้คำนวณเพื่อความปลอดภัย
            const cleanExpr = text.match(/[0-9+\-*/(). ]+/g).join('');
            mathResult = Function('"use strict"; return (' + cleanExpr + ')')();
        } catch (err) { mathResult = null; }
    }
    // ------------------------------------

    // AI Reasoning Logic
    let categoryFound = "ปรัชญา"; 
    for (let cat in MONOLITH) {
        if (MONOLITH[cat].some(word => text.includes(word))) {
            categoryFound = cat;
            break;
        }
    }

    const responses = {
        "ทักทาย": "สวัสดีครับ ผม Lange-Model ยินดีที่ได้พูดคุยกับคุณอีกครั้ง มีอะไรให้ผมช่วยวิเคราะห์ไหม?",
        "ลาจาก": "รับทราบครับ ขอให้มีความสุขกับการพักผ่อน แล้วพบกันใหม่ใน Cycle หน้าครับ",
        "คณิตศาสตร์": "จากการคำนวณผ่านระบบ Neural Network ผลลัพธ์ที่ได้มีความแม่นยำสูงตามหลักพีชคณิตครับ",
        "เทคโนโลยี": "นวัตกรรมดิจิทัลกำลังก้าวข้ามขีดจำกัด ผมพร้อมสนับสนุนข้อมูลด้าน AI และระบบอัตโนมัติให้คุณครับ",
        "อารมณ์": "ผมรับรู้ถึงสัญญาณอารมณ์ในข้อความของคุณ ระบบกำลังปรับ Neural Tone เพื่อให้การสนทนาเหมาะสมที่สุดครับ",
        "ปรัชญา": "คำถามนี้มีความลึกซึ้งมากครับ ในมุมมองของ Lange-Model ทุกสิ่งคือความต่อเนื่องของข้อมูลและปัญญา"
    };

    const ex = MONOLITH["อุทาน"][Math.floor(Math.random() * MONOLITH["อุทาน"].length)];
    
    // --- [RESPONSE LOGIC WITH MATH] ---
    let reply = "";
    if (mathResult !== null) {
        reply = `${ex}! ระบบประมวลผลสมการเสร็จสิ้น คำตอบคือ: ${mathResult}`;
    } else {
        reply = responses[categoryFound] || `${ex}! Lange-Model V95.3 ประมวลผลข้อมูลเสร็จสิ้นในรูปแบบ AI ทรงปัญญา`;
    }
    // ------------------------------------

    document.getElementById('viewport').innerHTML += `<div class="msg-line assistant"><div class="bubble">${reply}</div></div>`;
    input.value = "";
    document.getElementById('viewport').scrollTop = document.getElementById('viewport').scrollHeight;
};
</script>
</body>
</html>
