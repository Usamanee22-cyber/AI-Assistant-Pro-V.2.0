<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Monolith-V68-DualScreen-Training-Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans Thai', sans-serif; }
        body { background: #010409; height: 100vh; overflow: hidden; color: #1e293b; }
        .hidden { display: none; }
        #viewport { flex: 1; overflow-y: auto; padding: 30px; background: #f8fafc; display: flex; flex-direction: column; gap: 15px; }
        .bubble { padding: 18px 25px; border-radius: 28px; max-width: 80%; font-size: 18px; line-height: 1.6; }
        .assistant .bubble { background: white; border: 1.5px solid #e2e8f0; color: #334155; }
        .user .bubble { background: #3b82f6; color: white; margin-left: auto; }
        /* Animation สำหรับกราฟ */
        .line-transition { transition: d 0.5s ease-in-out; }
    </style>
</head>
<body>

<div id="setup" class="h-full flex flex-col items-center justify-center bg-slate-900 text-white gap-8">
    <div class="text-center">
        <h1 class="text-5xl font-black tracking-tighter uppercase mb-2">Lange-Model V68.0</h1>
        <p class="text-blue-400 font-bold tracking-[0.3em]">NEURAL TRAINING INTERFACE</p>
    </div>
    <div class="flex gap-6">
        <button onclick="init('CHAT')" class="bg-blue-600 px-12 py-8 rounded-[35px] font-black text-2xl hover:scale-105 transition-all">จอ 1: หน้าแชท</button>
        <button onclick="init('MONITOR')" class="bg-white text-slate-900 px-12 py-8 rounded-[35px] font-black text-2xl hover:scale-105 transition-all">จอ 2: วิเคราะห์กราฟ</button>
    </div>
</div>

<div id="chatUI" class="hidden h-full flex flex-col bg-white">
    <header class="p-8 border-b flex justify-between items-center">
        <h2 class="text-2xl font-black uppercase">Lange-Model <span class="text-blue-600">Active</span></h2>
        <div id="pillarSignal" class="flex gap-1"></div> </header>
    <main id="viewport"><div id="chatFlow"></div></main>
    <footer class="p-8 border-t">
        <form id="actionForm" class="flex gap-4 bg-slate-100 p-2 rounded-full border-2 border-transparent focus-within:border-blue-600 transition-all">
            <input type="text" id="userInput" autocomplete="off" placeholder="คุยกับโมเดล หรือเทรนความฉลาดเพิ่ม..." class="flex-1 bg-transparent outline-none px-10 font-bold text-xl">
            <button class="bg-blue-600 text-white px-12 py-5 rounded-full font-black">SEND</button>
        </form>
    </footer>
</div>

<div id="monitorUI" class="hidden h-full flex flex-col bg-slate-950 p-10 overflow-hidden">
    <h2 class="text-white text-3xl font-black uppercase mb-10 tracking-widest">Training Monitor <span class="text-green-500 animate-pulse">● LIVE</span></h2>
    <div class="grid grid-cols-1 gap-10 h-full">
        <div class="bg-slate-900 p-10 rounded-[50px] border border-slate-800">
            <div class="flex justify-between mb-4">
                <span class="text-blue-500 font-black text-xs uppercase">● เส้นความคงความฉลาด (Accuracy)</span>
                <span class="text-red-500 font-black text-xs uppercase">● เส้นบกพร่อง (Loss/Error)</span>
            </div>
            <svg width="100%" height="350" viewBox="0 0 1000 350" preserveAspectRatio="none">
                <path id="pathAcc" d="M 0 350" stroke="#3b82f6" stroke-width="8" fill="none" class="line-transition"></path>
                <path id="pathLoss" d="M 0 50" stroke="#ef4444" stroke-width="8" fill="none" class="line-transition"></path>
            </svg>
        </div>
        <div class="bg-black p-8 rounded-[40px] font-mono text-green-400 text-sm overflow-y-auto">
            <div id="logContent">> Waiting for neural input...</div>
        </div>
    </div>
</div>

<script>
/**
 * [CORE ENGINE: PILLARS 8-15 + TRAINING LOGIC]
 */
class LangeV68 {
    constructor() {
        this.lexicon = {
            BIZ: ["ทุน", "กำไร", "roi", "หุ้น"],
            TECH: ["ช่าง", "ซ่อม", "เหล็ก", "ปูน"],
            BASIC: ["สวัสดี", "ทักทาย", "ดีจ้า"]
        };
        this.accData = [300, 280, 290]; // กราฟความฉลาด (Y ต่ำ = สูงในชีวิตจริง)
        this.lossData = [50, 80, 60];  // กราฟบกพร่อง
        this.isMonitor = false;
    }

    // [TOKENIZE & PILLAR LOGIC]
    decide(input) {
        const tokens = input.toLowerCase().split(/(\s+|สวัสดี|กำไร|ซ่อม|ทุน)/).filter(t => t && t.trim());
        
        // Pillar 8-11: แยกหมวดหมู่
        let hasBiz = tokens.some(t => this.lexicon.BIZ.includes(t));
        let hasTech = tokens.some(t => this.lexicon.TECH.includes(t));
        let hasBasic = tokens.some(t => this.lexicon.BASIC.includes(t));

        // Logic ตามสั่ง: ใช้ Pillar ตัดสินก่อน ถ้าจนมุม (ไม่เจอหมวด) -> Train
        if (hasBasic) return { type: 'PILLAR', msg: "สวัสดีครับคุณโตนัส! Lange-Model ยินดีให้บริการครับ" };
        if (hasBiz) return { type: 'PILLAR', msg: `[Pillar 13: Biz] วิเคราะห์กำไรจาก "${input}"...` };
        if (hasTech) return { type: 'PILLAR', msg: `[Pillar 14: Tech] วิเคราะห์งานช่างจาก "${input}"...` };

        // [TRAINING MODE] เมื่อจนมุม (Pillar 15)
        return { type: 'TRAIN', msg: `[Lange-Model] จนมุม! เริ่มการ Self-Training ประโยค "${input}" เพื่อลดความบกพร่อง...` };
    }

    updateData(type) {
        let lastAcc = this.accData[this.accData.length-1];
        let lastLoss = this.lossData[this.lossData.length-1];

        if (type === 'TRAIN') {
            // ช่วงเทรน: สูงๆ ต่ำๆ
            this.accData.push(lastAcc + (Math.random() * 40 - 20));
            this.lossData.push(lastLoss + (Math.random() * 40 - 20));
        } else {
            // ช่วงฉลาด: Loss ต่ำลง (Y สูงขึ้นใน SVG), Acc ชันขึ้น (Y ต่ำลงใน SVG)
            this.accData.push(Math.max(50, lastAcc - 30)); 
            this.lossData.push(Math.min(300, lastLoss + 30));
        }
        
        localStorage.setItem('LANGE_V68_DATA', JSON.stringify({
            acc: this.accData,
            loss: this.lossData,
            lastText: type
        }));
    }
}

const engine = new LangeV68();

function init(mode) {
    document.getElementById('setup').classList.add('hidden');
    if (mode === 'CHAT') {
        document.getElementById('chatUI').classList.remove('hidden');
        // สร้างไฟสัญญาณ Pillar 8-15
        for(let i=8; i<=15; i++) {
            document.getElementById('pillarSignal').innerHTML += `<div class="w-3 h-3 rounded-full bg-slate-200" title="Pillar ${i}"></div>`;
        }
    } else {
        document.getElementById('monitorUI').classList.remove('hidden');
        setInterval(drawMonitor, 500);
    }
}

function drawMonitor() {
    const raw = localStorage.getItem('LANGE_V68_DATA');
    if (!raw) return;
    const data = JSON.parse(raw);

    const drawPath = (id, points) => {
        let d = `M 0 ${points[0]}`;
        const step = 1000 / (points.length - 1);
        points.forEach((p, i) => d += ` L ${i * step} ${p}`);
        document.getElementById(id).setAttribute('d', d);
    };

    drawPath('pathAcc', data.acc);
    drawPath('pathLoss', data.loss);
    document.getElementById('logContent').innerHTML = `> Status: ${data.lastText} updated. Accuracy point: ${data.acc.length}<br>` + document.getElementById('logContent').innerHTML;
}

document.getElementById('actionForm').onsubmit = (e) => {
    e.preventDefault();
    const input = document.getElementById('userInput');
    const val = input.value.trim();
    if(!val) return;

    const result = engine.decide(val);
    engine.updateData(result.type);

    document.getElementById('chatFlow').innerHTML += `<div class="msg-line user"><div class="bubble">${val}</div></div>`;
    setTimeout(() => {
        document.getElementById('chatFlow').innerHTML += `<div class="msg-line assistant"><div class="bubble">${result.msg}</div></div>`;
        document.getElementById('viewport').scrollTop = document.getElementById('viewport').scrollHeight;
    }, 400);
    input.value = '';
};
</script>
</body>
</html>
