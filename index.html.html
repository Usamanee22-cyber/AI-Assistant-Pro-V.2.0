<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Lange-Model V86.0: 700 Unique Cores</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Noto+Sans+Thai:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Noto Sans Thai', sans-serif; box-sizing: border-box; }
        body { background: #010409; color: #e6edf3; height: 100vh; overflow: hidden; margin: 0; }
        .code-font { font-family: 'Fira Code', monospace; }
        .hidden { display: none !important; }
        
        /* Layout */
        #viewport { flex: 1; overflow-y: auto; padding: 20px; background: #010409; display: flex; flex-direction: column; gap: 10px; }
        .msg-line { display: flex; width: 100%; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .assistant .bubble { background: #161b22; border-left: 4px solid #238636; padding: 10px 15px; border-radius: 15px; max-width: 85%; }
        .user .bubble { background: #238636; color: white; padding: 10px 15px; border-radius: 15px; max-width: 85%; margin-left: auto; }

        /* Vocab Monolith */
        .v-scroll { height: calc(100vh - 120px); overflow-y: auto; }
        .v-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 2px; }
        .v-item { font-size: 8px; background: #0d1117; border: 1px solid #30363d; color: #8b949e; text-align: center; border-radius: 2px; padding: 2px; }
        
        /* Monitor */
        .qr-white-box { background: white; padding: 10px; border-radius: 12px; }
        .graph-container { background: #000; border: 1px solid #30363d; border-radius: 20px; position: relative; overflow: hidden; }
    </style>
</head>
<body>

<div id="gatekeeper" class="h-full flex flex-col items-center justify-center bg-[#0d1117]">
    <div class="mb-8 text-center">
        <div class="w-16 h-16 bg-green-500 rounded-2xl mx-auto mb-4 flex items-center justify-center text-4xl font-black text-black">L</div>
        <h1 class="text-3xl font-black">LANGE <span class="text-green-500 underline">V86.0</span></h1>
    </div>
    <div class="w-64 space-y-3">
        <input type="text" id="accessName" class="w-full bg-[#161b22] border border-[#30363d] p-4 rounded-xl text-center text-white outline-none focus:border-green-500" placeholder="IDENTIFY (โตนัส)">
        <button onclick="unlockGate()" class="w-full bg-white text-black p-4 rounded-xl font-black hover:bg-green-500">INITIALIZE</button>
    </div>
</div>

<div id="scannerUI" class="hidden h-full flex flex-col items-center justify-center bg-black">
    <div id="reader" class="w-80 rounded-2xl overflow-hidden border-2 border-green-500"></div>
    <p class="mt-4 text-green-500 font-bold">READY TO SYNC...</p>
</div>

<div id="devUI" class="hidden h-full flex flex-col">
    <header class="p-4 border-b border-[#30363d] flex justify-between items-center bg-[#0d1117]">
        <div class="flex items-center gap-3">
            <span class="font-black text-sm uppercase tracking-widest text-green-500">Master Lab</span>
            <span id="connStatus" class="text-[9px] bg-red-900 text-red-200 px-2 py-1 rounded">No Link</span>
        </div>
        <div class="qr-white-box"><div id="qrcode"></div></div>
    </header>
    <div class="flex flex-1 overflow-hidden">
        <aside class="w-80 bg-black p-4 border-r border-[#30363d]">
            <h3 class="text-xs font-bold text-slate-500 mb-4 uppercase flex justify-between">
                <span>Memory Monolith</span>
                <span id="wordCount">0/700</span>
            </h3>
            <div id="vocabList" class="v-scroll space-y-4"></div>
        </aside>
        <main class="flex-1 flex flex-col">
            <div id="viewport"></div>
            <form id="devForm" class="p-4 border-t border-[#30363d] flex gap-2">
                <input type="text" id="devInput" class="flex-1 bg-[#161b22] p-4 rounded-xl text-white outline-none border border-transparent focus:border-green-500" placeholder="คุย / คำนวณ / หมวด-คำ">
                <button class="bg-green-600 px-8 rounded-xl font-bold">EXEC</button>
            </form>
        </main>
    </div>
</div>

<div id="monitorUI" class="hidden h-full bg-[#010409] p-10 flex flex-col">
    <div class="flex justify-between items-end mb-10">
        <div>
            <h2 class="text-3xl font-black text-white">NEURAL STREAM</h2>
            <p class="text-green-500 text-xs">Real-time Data Visualization</p>
        </div>
        <div class="flex gap-6">
            <div class="text-right">
                <p class="text-[10px] text-slate-500 uppercase">Accuracy</p>
                <h3 id="accVal" class="text-3xl font-black text-blue-400">0%</h3>
            </div>
            <div class="text-right">
                <p class="text-[10px] text-slate-500 uppercase">Loss</p>
                <h3 id="lossVal" class="text-3xl font-black text-red-400">0%</h3>
            </div>
        </div>
    </div>
    <div class="flex-1 graph-container p-6">
        <svg width="100%" height="100%" viewBox="0 0 1000 400" preserveAspectRatio="none">
            <path id="pathAcc" d="M 0 400" stroke="#388bfd" stroke-width="4" fill="none" style="transition: 0.3s;"></path>
            <path id="pathLoss" d="M 0 400" stroke="#f85149" stroke-width="4" fill="none" style="transition: 0.3s;"></path>
        </svg>
    </div>
</div>

<script>
// --- UNIQUE 700 WORDS GENERATOR ---
const CATEGORIES = ["สัตว์", "พืช", "ธุรกิจ", "อวกาศ", "คณิต", "ความรู้สึก", "เทคโนโลยี"];
let vocabDB = {};

// สร้างคำศัพท์ 100 คำต่อหมวดที่ไม่ซ้ำกัน
CATEGORIES.forEach(cat => {
    vocabDB[cat] = Array.from({length: 100}, (_, i) => `${cat}_Core_${String(i+1).padStart(3, '0')}`);
});

class LangeV86Engine {
    constructor() {
        this.acc = Array(50).fill(200);
        this.loss = Array(50).fill(100);
    }
    
    process(text) {
        // 1. Math Analysis
        const mathExpr = text.replace(/[^0-9+\-*/().]/g, '');
        if (mathExpr.length >= 3) {
            try { 
                const res = new Function(`return ${mathExpr}`)();
                return { reply: `[MATH ENGINE] ${mathExpr} = ${res}`, success: true };
            } catch(e) {}
        }
        
        // 2. Vocab Matching
        let found = CATEGORIES.find(c => text.includes(c));
        if (found) return { reply: `[DATA] เข้าถึงหมวดหมู่ ${found} เรียบร้อย`, success: true };
        
        return { reply: "Lange กำลังประมวลผลข้อมูลใหม่...", success: false };
    }

    updateStats(success) {
        let lastA = this.acc[this.acc.length-1];
        let lastL = this.loss[this.loss.length-1];
        this.acc.push(Math.min(400, Math.max(0, lastA + (success ? 25 : -35) + (Math.random()*15-7))));
        this.loss.push(Math.min(400, Math.max(0, lastL + (success ? -20 : 30) + (Math.random()*15-7))));
        this.acc.shift(); this.loss.shift();
    }
}

const engine = new LangeV86Engine();
const SYNC_ID = "LANGE_PRO_860";
let peer, conn;

function unlockGate() {
    const name = document.getElementById('accessName').value.trim();
    if(name === "โตนัส") {
        const mode = prompt("LANGE V86.0\n1: Master Lab\n2: Monitor UI");
        document.getElementById('gatekeeper').classList.add('hidden');
        if(mode === "1") initLab(); else startScanner();
    }
}

function startScanner() {
    document.getElementById('scannerUI').classList.remove('hidden');
    const sc = new Html5Qrcode("reader");
    sc.start({ facingMode: "environment" }, { fps: 20, qrbox: 250 }, (id) => {
        if(id === SYNC_ID) { sc.stop(); initMonitor(); }
    });
}

function initLab() {
    document.getElementById('devUI').classList.remove('hidden');
    peer = new Peer(SYNC_ID);
    peer.on('open', id => new QRCode(document.getElementById("qrcode"), {text: id, width: 80, height: 80}));
    peer.on('connection', c => { 
        conn = c; 
        document.getElementById('connStatus').innerText = "Link Active";
        document.getElementById('connStatus').className = "text-[9px] bg-green-900 text-green-200 px-2 py-1 rounded";
    });
    renderVocab();
}

function initMonitor() {
    document.getElementById('scannerUI').classList.add('hidden');
    document.getElementById('monitorUI').classList.remove('hidden');
    peer = new Peer();
    peer.on('open', () => {
        const c = peer.connect(SYNC_ID);
        c.on('data', data => {
            engine.acc = data.acc; engine.loss = data.loss;
            updateGraph();
        });
    });
}

function renderVocab() {
    let total = 0;
    document.getElementById('vocabList').innerHTML = Object.entries(vocabDB).map(([cat, words]) => {
        total += words.length;
        return `<div><p class="text-[10px] text-green-500 font-bold mb-1">${cat}</p>
                <div class="v-grid">${words.slice(0, 40).map(w => `<div class="v-item">${w}</div>`).join('')}</div>
                <p class="text-[8px] text-slate-600 mt-1">... and 60 more words</p></div>`;
    }).join('');
    document.getElementById('wordCount').innerText = `${total}/700`;
}

function updateGraph() {
    const d = (pts) => pts.map((p, i) => `${i === 0 ? 'M' : 'L'} ${i*20} ${400-p}`).join(' ');
    document.getElementById('pathAcc').setAttribute('d', d(engine.acc));
    document.getElementById('pathLoss').setAttribute('d', d(engine.loss));
    document.getElementById('accVal').innerText = Math.floor(engine.acc[49]/4) + "%";
    document.getElementById('lossVal').innerText = Math.floor(engine.loss[49]/4) + "%";
}

document.getElementById('devForm').onsubmit = (e) => {
    e.preventDefault();
    const inp = document.getElementById('devInput');
    const val = inp.value.trim();
    if(!val) return;

    const res = engine.process(val);
    engine.updateStats(res.success);
    
    document.getElementById('viewport').innerHTML += `
        <div class="msg-line user"><div class="bubble">${val}</div></div>
        <div class="msg-line assistant"><div class="bubble">${res.reply}</div></div>`;
    
    if(conn) conn.send({ acc: engine.acc, loss: engine.loss });
    inp.value = "";
    document.getElementById('viewport').scrollTop = document.getElementById('viewport').scrollHeight;
};
</script>
</body>
</html>
